<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30986898-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-30986898-2');
</script>

  
  <title>Expire data in CosmosDb | Dibran&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Applications often have to deal with temporary data, such as: logs, user session information and others.Purging that data can be a struggle especially when your database doesn’t support temporary stor">
<meta name="keywords" content="Azure, CosmosDb, TTL, Expire">
<meta property="og:type" content="article">
<meta property="og:title" content="Expire data in CosmosDb">
<meta property="og:url" content="http://dibranmulder.github.io/2018/06/25/Expire-data-in-CosmosDb/index.html">
<meta property="og:site_name" content="Dibran&#39;s Blog">
<meta property="og:description" content="Applications often have to deal with temporary data, such as: logs, user session information and others.Purging that data can be a struggle especially when your database doesn’t support temporary stor">
<meta property="og:locale" content="NL">
<meta property="og:updated_time" content="2018-11-13T18:36:02.069Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Expire data in CosmosDb">
<meta name="twitter:description" content="Applications often have to deal with temporary data, such as: logs, user session information and others.Purging that data can be a struggle especially when your database doesn’t support temporary stor">
  
    <link rel="alternate" href="/atom.xml" title="Dibran&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Dibran&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Cloud, Modern web technologies, Microsoft, security and more</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://dibranmulder.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Expire-data-in-CosmosDb" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/25/Expire-data-in-CosmosDb/" class="article-date">
  <time datetime="2018-06-25T09:50:22.000Z" itemprop="datePublished">2018-06-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Expire data in CosmosDb
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Applications often have to deal with temporary data, such as: logs, user session information and others.<br>Purging that data can be a struggle especially when your database doesn’t support temporary storage.<br>With CosmosDb, developers are able to set Time To Live properties on Collections and Documents.</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>Lets say you have a shopping cart in your application with which users can select items.<br>It doesn’t make sense to have those items indefinitely in your cart, lets say one week will be suffice.<br>Lets see how we can set the time to live to one week.</p>
<h3 id="Create-a-collection-with-a-default-time-to-live"><a href="#Create-a-collection-with-a-default-time-to-live" class="headerlink" title="Create a collection with a default time to live"></a>Create a collection with a default time to live</h3><p>In order for time to live to be effective you have to set a default time to live on the collection. Setting it on <strong>documents alone will not work</strong>. You can also replace the collection and set it to <code>null</code> to disable the time to live for the collection.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> documentClient.CreateDatabaseIfNotExistsAsync(<span class="keyword">new</span> Database()</span><br><span class="line">&#123;</span><br><span class="line">    Id = <span class="string">"MyShop"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creating a collection with a default time to live.</span></span><br><span class="line">DocumentCollection collection = <span class="keyword">await</span> documentClient.CreateDocumentCollectionIfNotExistsAsync(</span><br><span class="line">    UriFactory.CreateDatabaseUri(<span class="string">"MyShop"</span>),</span><br><span class="line">    <span class="keyword">new</span> DocumentCollection</span><br><span class="line">    &#123;</span><br><span class="line">        Id = <span class="string">"ShoppingCart"</span>,</span><br><span class="line">        <span class="comment">// Set default time to live to one week. </span></span><br><span class="line">        DefaultTimeToLive = <span class="number">24</span> * <span class="number">60</span> * <span class="number">7</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">new</span> RequestOptions</span><br><span class="line">    &#123;</span><br><span class="line">        OfferThroughput = <span class="number">400</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable the time to live.</span></span><br><span class="line">collection.DefaultTimeToLive = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> client.ReplaceDocumentCollectionAsync(collection);</span><br></pre></td></tr></table></figure>
<p>Once you’ve set the time to live on collections than every document will have that time to live as default. You can override it to prolong, shorten or disable the time to live for the selected document.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set time to live</span></span><br><span class="line">cart.TimeToLive = TimeToLiveSeconds;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable time to live</span></span><br><span class="line">cart.TimeToLive = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> documentClient.CreateDocumentAsync(</span><br><span class="line">    UriFactory.CreateDocumentCollectionUri(<span class="string">"MyShop"</span>, <span class="string">"ShoppingCart"</span>),</span><br><span class="line">    cart);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update time to live</span></span><br><span class="line">cart.TimeToLive = TimeToLiveSeconds;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> documentClient.ReplaceDocumentAsync(cart);</span><br></pre></td></tr></table></figure>
<p>Once a document is created in a time to live collection then a <code>_ttl</code> property will be added to the document. Note that it doesn’t count down or something like that so you can’t see if a document is about to expire.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"userId"</span>: <span class="string">"test@user.com"</span>,</span><br><span class="line">    <span class="attr">"cart"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"itemId"</span>: <span class="string">"49a4ce2c-ddde-4f04-bb79-46546566a"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Bike"</span>,</span><br><span class="line">            <span class="attr">"desc"</span>: <span class="string">"A brandnew bike"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"itemId"</span>: <span class="string">"dfsa8789-abde-4f04-bb79-46546566a"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Helmet"</span>,</span><br><span class="line">            <span class="attr">"desc"</span>: <span class="string">"A helmet keeps you save"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"ttl"</span>: <span class="number">10080</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"49a4ce2c-99e4-4f04-bb79-35a9c3a4d6b5"</span>,</span><br><span class="line">    <span class="attr">"_rid"</span>: <span class="string">"VfYnAKmODgAkAAAAAAAAAA=="</span>,</span><br><span class="line">    <span class="attr">"_self"</span>: <span class="string">"dbs/VfYnAA==/colls/VfYnAKmODgA=/docs/VfYnAKmODgAkAAAAAAAAAA==/"</span>,</span><br><span class="line">    <span class="attr">"_etag"</span>: <span class="string">"\"0100cb12-0000-0000-0000-5b2a44170000\""</span>,</span><br><span class="line">    <span class="attr">"_attachments"</span>: <span class="string">"attachments/"</span>,</span><br><span class="line">    <span class="attr">"_ts"</span>: <span class="number">1529496599</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Hopefully this helped a little, for further reading please see:<br><a href="https://docs.microsoft.com/en-us/azure/cosmos-db/time-to-live" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/cosmos-db/time-to-live</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dibranmulder.github.io/2018/06/25/Expire-data-in-CosmosDb/" data-id="cjog5uqyu000jy4491z2df20n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure-CosmosDb-TTL-Expire/">Azure, CosmosDb, TTL, Expire</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/03/Unique-keys-in-Azure-Cosmos-DB/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Unique keys in Azure Cosmos DB
        
      </div>
    </a>
  
  
    <a href="/2018/06/22/Bedrijfskritische-applicaties-in-de-cloud/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Bedrijfskritische applicaties in de cloud</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-DevOps-Secrets-FoxIt-Azure-ResourceGroups/">Azure DevOps, Secrets, FoxIt, Azure, ResourceGroups.</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-AD-MSI-Mananged-Service-Identity/">Azure, AD, MSI, Mananged Service Identity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-API-Management/">Azure, API Management</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-API-management-Functions-API-Gateway/">Azure, API management, Functions, API Gateway.</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-CosmosDb-TTL-Expire/">Azure, CosmosDb, TTL, Expire</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-CosmosDb-UniqueKeys-PrimaryKey/">Azure, CosmosDb, UniqueKeys, PrimaryKey</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-Entity-Framework-Core-EF-Core-Migrations-VSTS-Functions-V2-Dependency-Injection/">Azure, Entity Framework Core, EF Core, Migrations, VSTS, Functions V2, Dependency Injection.</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud-resilient-availability-zone/">cloud, resilient, availability, zone</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Azure-DevOps-Secrets-FoxIt-Azure-ResourceGroups/" style="font-size: 10px;">Azure DevOps, Secrets, FoxIt, Azure, ResourceGroups.</a> <a href="/tags/Azure-AD-MSI-Mananged-Service-Identity/" style="font-size: 10px;">Azure, AD, MSI, Mananged Service Identity</a> <a href="/tags/Azure-API-Management/" style="font-size: 10px;">Azure, API Management</a> <a href="/tags/Azure-API-management-Functions-API-Gateway/" style="font-size: 10px;">Azure, API management, Functions, API Gateway.</a> <a href="/tags/Azure-CosmosDb-TTL-Expire/" style="font-size: 10px;">Azure, CosmosDb, TTL, Expire</a> <a href="/tags/Azure-CosmosDb-UniqueKeys-PrimaryKey/" style="font-size: 10px;">Azure, CosmosDb, UniqueKeys, PrimaryKey</a> <a href="/tags/Azure-Entity-Framework-Core-EF-Core-Migrations-VSTS-Functions-V2-Dependency-Injection/" style="font-size: 10px;">Azure, Entity Framework Core, EF Core, Migrations, VSTS, Functions V2, Dependency Injection.</a> <a href="/tags/cloud-resilient-availability-zone/" style="font-size: 10px;">cloud, resilient, availability, zone</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">november 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">oktober 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">augustus 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">juli 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">juni 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/11/13/Azure-Api-Management-overview/">Azure API  Management overview</a>
          </li>
        
          <li>
            <a href="/2018/10/25/Secrets-in-Azure-DevOps-the-bad-parts/">Secrets in Azure DevOps the bad parts</a>
          </li>
        
          <li>
            <a href="/2018/10/19/Building-Serverless-APIs-in-Azure/">Building Serverless API&#39;s in Azure</a>
          </li>
        
          <li>
            <a href="/2018/10/05/Azure-AD-Managed-Service-Identity/">Azure AD Managed Service Identity</a>
          </li>
        
          <li>
            <a href="/2018/08/23/Azure-functions-V2-with-EF-Core/">Azure functions V2 with EF Core</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Dibran Mulder<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>